plugins {
    id 'org.gradle.guides.topical' version '0.8'
    id 'org.gradle.guides.test-jvm-code' version '0.8'
}

guide {
    repoPath 'gradle-guides/using-build-cache'
    mainAuthor 'Stefan Wolf, Lóránt Pintér'
}

asciidoctor {
    resources {
        from(file('contents/css')) {
            into 'css'
        }
        from(file('contents/images')) {
            into 'images'
        }
    }

    if (System.getProperty("os.name").toLowerCase().contains("mac")) {
        doLast {
            ["osascript", "-e", """
                    try
                        tell application "Finder" to get application file id "com.google.Chrome"
                        set appExists to true
                    on error
                        set appExists to false
                    end try
                    if appExists then
                        tell application "Google Chrome"
                            set theUrl to "file://$outputDir.absolutePath"
                            set found to false
                            set theWindowIndex to 0
                            repeat with theWindow in every window
                                set theTabIndex to 0
                                repeat with theTab in every tab of theWindow
                                    set theTabIndex to theTabIndex + 1
                                    if theTab's URL starts with theUrl then
                                        set found to true
                                        tell application "Google Chrome" to set active tab index of theWindow to theTabIndex
                                        tell theTab to reload
                                    end if
                                end repeat
                            end repeat
                            if not found then
                                set URL of (active tab of (make new window)) to theUrl & "/html5/index.html"
                            end if
                        end tell
                    end if
                """].execute()
        }
    }
}
