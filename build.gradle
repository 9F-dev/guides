plugins {
    id "org.gradle.guides.getting-started" version "0.11.5"
    id "org.gradle.guides.test-jvm-code" version "0.11.5"
}

guide {
    repoPath 'gradle-guides/publishing-plugins-to-gradle-plugin-portal'
    mainAuthor 'Schalk Cronj√©'
}

repositories {
    maven {
        url "https://plugins.gradle.org/m2/"
    }
}

configurations {
    pluginClasspath
}

dependencies {
    pluginClasspath 'com.gradle.publish:plugin-publish-plugin:0.9.7'
}

asciidoctor {
    attributes 'exampledir'  : file('src/publicationTest').absolutePath
}

test {
    ext {
        httpServerPort = 65000
    }
    systemProperties 'gradle.portal.url' : "http://localhost:${httpServerPort}"
    systemProperties 'HTTPSERVER_PORT' : httpServerPort
    systemProperties 'TEMPLATE_DIR' : file('src/publicationTest').absolutePath
    systemProperties 'PLUGIN_CLASSPATH' : file("${buildDir}/pluginClasspath").absolutePath

    inputs.dir 'src/publicationTest'

    doFirst {
        copy {
            from configurations.pluginClasspath
            into "${buildDir}/pluginClasspath"
        }
    }
}

