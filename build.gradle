plugins {
    id "org.gradle.guides.getting-started" version "0.15.8"
    id "org.gradle.guides.test-jvm-code" version "0.15.8"
}

guide {
    repoPath 'gradle-guides/publishing-plugins-to-gradle-plugin-portal'
    mainAuthor 'Schalk Cronj√©'
    minimumGradleVersion = "4.10.3"
}

repositories {
    maven {
        url "https://plugins.gradle.org/m2/"
    }
}

configurations {
    pluginClasspath
}

dependencies {
    pluginClasspath 'com.gradle.publish:plugin-publish-plugin:0.10.1'
}

test {
    ext {
        httpServerPort = 65000
    }
    systemProperties 'gradle.portal.url' : "http://localhost:${httpServerPort}"
    systemProperties 'HTTPSERVER_PORT' : httpServerPort
    systemProperties 'PLUGIN_CLASSPATH' : file("${buildDir}/pluginClasspath").absolutePath

    doFirst {
        copy {
            from configurations.pluginClasspath
            into "${buildDir}/pluginClasspath"
        }
    }
}
