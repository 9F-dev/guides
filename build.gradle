plugins {
    id 'org.gradle.guides.getting-started' version '0.5.5'

    // Uncomment this line if you need test JVM code snippets
    // id 'org.gradle.guides.test-jvm-code' version '0.5.5'
}

import org.apache.tools.ant.filters.*

guide {
    repoPath 'gradle-guides/consuming-jvm-libraries'
    mainAuthor 'Schalk CronjÃ©'
}

asciidoctor {
    attributes example : file('src/example').absolutePath
    attributes 'gradle-outdir' : "${gradleRunner.reportsDir.absolutePath}"
}

gradleRunner {
    inputs.dir 'src/example'

    step 'create', {
        copy {
            from 'src/example', {
                include '*.gradle'
                include 'src/**'
            }
            into workingDir
        }
    }

    step 'dependencies', 'dependencies', '--configuration=implementation'

    step 'assemble', 'assemble', '--console=rich'

    step 'build', 'build', '--console=rich'

    step 'install', 'installDist', '--console=rich'

    step 'run', { info ->

        File runFile = file("${info.reportDir}/run.txt")
        runFile.withOutputStream { runOutput ->
            project.exec {
                workingDir file("${gradleRunner.workingDir}/build/install/greeterApp")
                executable 'bin/greeterApp'
                args 'Gradle'

                standardOutput runOutput
            }
        }
    }
}
