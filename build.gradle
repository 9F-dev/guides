plugins {
    id "org.ajoberstar.github-pages" version "1.4.2"
    id "org.asciidoctor.convert" version "1.5.3"
}
apply plugin: "base"

asciidoctor {
    sourceDir = rootDir
    sources {
      include "README.adoc"
    }
    outputDir = buildDir
    backends = ["html5"]
    attributes "source-highlighter": "coderay",
            "coderay-linenums-mode": "table",
            imagesdir: "images",
            // stylesheet: "guide.css", //This allows us to omit Asciidoc base styles
            sectanchors: true,
            sectlinks: true,
            linkattrs: true,
            encoding: "utf-8",
            toc: "right"
            // docinfo1: "" // Tells asciidoc to include docs/asciidoc/docinfo.html at the top
}

task copyIndex {
    doLast {
        file("${asciidoctor.outputDir}/${asciidoctor.backends[0]}/README.html")
            .renameTo("${asciidoctor.outputDir}/${asciidoctor.backends[0]}/index.html")
    }
}

githubPages {
    repoUri = "git@github.com:gradle-guides/gs-template.git"
    pages {
        from "${asciidoctor.outputDir}/${asciidoctor.backends[0]}"
    }
}

assemble.dependsOn "asciidoctor", "copyIndex"
